# 2025春夏季训练营四阶段任务总结: axvior架构设计手册重构

## 概览
在本次训练营中我主要参与了AxVisor架构设计文档的重构工作。高质量的文档是上手一个项目最高效的方式。虽然现在随着AI技术的发展，DeepWiki已经可以生成高质量的架构文档。但DeepWiki的限制在于，它虽然可以描述已有的架构。但不能介绍架构背后的motivation和设计目标。这点对于一个有教学用途的AxVisor却十分重要。虽然读者仍然可以通过询问AI助手来部分解决这个问题，但追问模式的缺点在于得到的知识较为碎片，很难建构整体的理解。

出于这个考虑，笔者选择了重构AxVisor架构设计文档作为我的四阶段任务。目标是在讲清楚架构设计的同时给出足够的背景知识以及设计动机，确保只要对操作系统有基本概念的读者都可以比较轻易的理解AxVisor的架构和如此设计的原因。争取可以为以后加入AxVisor开发的学员或开发者减轻压力。

## 文档现状

原始文档中部分章节过分简略/包含过多细节。各个平行章节的提供的信息层级也参差不齐。
10.3 riscv章节是一个好的例子从RISCV架构讲起，讨论了虚拟化需要考虑的对象以及他们之间的对应关系。最后详细描述了几个重要子模块的设计。在设计中也不是简单的罗列已有的架构。而是首先讨论了需要实现的需求，再根据需求一一对应描述了代码的架构。
这个章节首先介绍了背景知识，然后提出了设计上的需求和挑战，最后介绍了代码的实现。同时在深入每个细节前会通过一段高层次的描述帮助读者建立之后内容的mindmap,方便读者理解。这是文档中很好的范例。
文档中的其它章节在这些方面或多或少有些疏漏。
比如7.0 AxVisor中，虽然在章节一开始提供了AxVisor的总体架构图，但是文字描述只涉及了图片中的一小部分，很多功能语焉不详。
10.1和10.2则大部分篇幅用于罗列代码实现的细节，缺少对于设计动机的描述，所以作为缺乏hypervisor开发经验的读者会难以理解将架构如此设计的原因。
13.0 passthrough device中仅仅罗列了使用了技术，但未介绍使用这些技术的原因，同时实现的细节也比较凌乱。
凡此种种，不再列举。
AxVisor的DeepWiki给文档中与架构和实现细节相关的部分提供了一个较为完整的起点。它给整个架构文档重新规划了一个可读性的更好的大纲，同时也给每个子模块都添加了比较完整的介绍。
然而DeepWiki文档也有它的缺点，首先它只能描述软件已有的架构，而不能介绍架构背后的设计目标和Motivation，而这两者对于一个tutorial类型的文档来说才是更为重要的。另外由于目前大模型的幻觉问题，DeepWiki的文档可信度也存疑，需要重新整理和Verify。（示意图可读性也较差）

其它小问题：
部分图片在夜间模式下可读性很差
图片格式字体不统一
部分文档排版较为混乱


## 修改计划

以原有文档为基础，参考DeepWiki给出的大纲和内容对架构设计手册进行重构，Verify DeepWiki内容的同时合并原有文档和DeepWiki的内容。并为每个文档都添加合适的设计目标，设计挑战，背景知识章节的部分。增强文档的可读性和文档的教学属性。
计划从axvisor开始

## 工作进展

在四阶段的工作中，在四阶段中最终重构完成了两个核心crate的对应章节: AxVisor和AxVM。AxVisor是整个项目的主crate，包含了程序入口和虚拟机监控器的实现。模块化的设计让AxVisor有十分清晰的架构，很适合作为Hypervisor的初学内容。在AxVisor文档中中我着重着墨在Hypervisor的抽象模型，并与代码本身关联介绍。

AxVM也是AxVisor的核心组件，负责管理每个虚拟机实例。在这篇文章中，我也将VMM提供的三个主要任务: 处理器虚拟化，内存虚拟化和IO虚拟化对应到了AxVM的实现上。并详细解释了在虚拟机实例生命周期中AxVM的管理机制。

同时，重构的文档也补充了很多缺失的细节。总的来说，笔者在四阶段完成的文档在易读性和完整性上和原有的文档相比均实现了较大的提升。

## 未来计划
由于在训练营期间时间有限，未能完成全部架构文档的重构计划。同时训练营的很多同侪也为AxVisor增加了很多新的特性，比如中断虚拟化等等。因此笔者计划在训练营结束后继续投入到文档开发中去。最终呈现出一个完整的适用于初学者的AxVisor架构手册。

目前计划的顺序如下: 
- AxVisor (已完成)
- axvm (已完成)
- axvcpu 架构无关部分
- axaddrspace
- axdevice
- virtual IRQ
- axvcpu 架构相关部分
- 其他架构相关组件




